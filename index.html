<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨ä»·å€¼è®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 10px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 100%;
            max-width: 100%;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 6px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 16px;
            margin-bottom: 2px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 10px;
            opacity: 0.9;
        }
        
        .form-container {
            padding: 6px;
        }
        
        .input-group {
            margin-bottom: 3px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 1px;
            font-weight: 600;
            color: #333;
            font-size: 9px;
        }
        
        .input-group input {
            width: 100%;
            padding: 4px;
            border: 1px solid #e1e5e9;
            border-radius: 3px;
            font-size: 11px;
            transition: all 0.3s ease;
            background-color: #fafafa;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .input-group input::placeholder {
            color: #999;
            font-size: 11px;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 5px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 6px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        .calculate-btn:active {
            transform: translateY(0);
        }
        
        .results {
            margin-top: 6px;
            padding: 5px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 4px;
            border-left: 2px solid #4CAF50;
            display: none;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 3px;
            padding: 2px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .result-label {
            font-weight: 600;
            color: #495057;
            font-size: 10px;
        }
        
        .result-value {
            color: #28a745;
            font-weight: 700;
            font-size: 12px;
        }
        
        
        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            padding: 10px;
            background-color: #f8d7da;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        
        .info-tip {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #17a2b8;
            font-size: 14px;
        }
        
        .info-tip strong {
            color: #0c5460;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .rate-info {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #c3e6cb;
            font-size: 14px;
        }
        
        .auto-loading {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
            font-size: 14px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 2px;
            }
            
            .container {
                margin: 0;
                border-radius: 6px;
            }
            
            .header {
                padding: 4px;
            }
            
            .header h1 {
                font-size: 14px;
            }
            
            .header p {
                font-size: 8px;
            }
            
            .form-container {
                padding: 4px;
            }
            
            /* ç§»åŠ¨ç«¯æ”¹ä¸ºå•åˆ—å¸ƒå±€ */
            .grid-2-columns {
                grid-template-columns: 1fr !important;
                gap: 3px !important;
                margin-bottom: 4px !important;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1px;
            }
            
            .input-group {
                margin-bottom: 2px;
            }
            
            .input-group label {
                font-size: 8px;
            }
            
            .input-group input {
                padding: 3px;
                font-size: 10px;
            }
            
            .input-group input::placeholder {
                font-size: 10px;
            }
            
            .calculate-btn {
                padding: 4px;
                font-size: 10px;
                margin-top: 4px;
            }
            
            .results {
                margin-top: 4px;
                padding: 3px;
            }
            
            .result-label {
                font-size: 9px;
            }
            
            .result-value {
                font-size: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 12px;
            }
            
            .header p {
                font-size: 7px;
            }
            
            .form-container {
                padding: 3px;
            }
            
            .input-group {
                margin-bottom: 1px;
            }
            
            .grid-2-columns {
                gap: 2px !important;
                margin-bottom: 3px !important;
            }
            
            .input-group label {
                font-size: 7px;
            }
            
            .input-group input {
                padding: 2px;
                font-size: 9px;
            }
            
            .input-group input::placeholder {
                font-size: 9px;
            }
            
            .header {
                padding: 3px;
            }
            
            .results {
                padding: 2px;
            }
        }
        
        @media (max-width: 360px) {
            .header h1 {
                font-size: 11px;
            }
            
            .header p {
                font-size: 6px;
            }
            
            .form-container {
                padding: 2px;
            }
            
            .input-group {
                margin-bottom: 1px;
            }
            
            .input-group label {
                font-size: 6px;
            }
            
            .input-group input {
                padding: 2px;
                font-size: 8px;
            }
            
            .input-group input::placeholder {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ è‚¡ç¥¨ä»·å€¼è®¡ç®—å™¨</h1>
            <p>ğŸ”’ æ•°æ®å€¼è®°å½•åœ¨æ‚¨çš„è®¾å¤‡ä¸­ï¼Œå¯å®‰å…¨ä½¿ç”¨</p>
        </div>
        
        <div class="form-container">
            
            <!-- è¡Œæƒä»·å’ŒæŒæœ‰è‚¡æ•°ç»„åˆ -->
            <div class="grid-2-columns" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 4px;">
                <div class="input-group">
                    <label for="shares">ğŸ“Š æŒæœ‰è‚¡æ•°</label>
                    <input type="number" id="shares" placeholder="è¯·è¾“å…¥æŒæœ‰è‚¡æ•°" min="0" step="1">
                </div>
                
                <div class="input-group">
                    <label for="strikePrice">âš¡ è¡Œæƒä»· (USD)</label>
                    <input type="number" id="strikePrice" placeholder="è¯·è¾“å…¥è¡Œæƒä»·" min="0" step="0.01">
                </div>
            </div>
            
            <!-- ç¾è‚¡å’Œæ¸¯è‚¡ä¸¤åˆ—å¸ƒå±€ -->
            <div class="grid-2-columns" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 4px;">
                <!-- ç¾è‚¡åˆ— -->
                <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 4px; border-radius: 4px; border-left: 2px solid #2196f3;">
                    <h3 style="margin: 0 0 3px 0; color: #1976d2; font-size: 10px; text-align: center;">ğŸ‡ºğŸ‡¸ ç¾è‚¡ HSAI</h3>
                    
                    <div class="input-group">
                        <label for="usStockCode">è‚¡ç¥¨ä»£ç </label>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="text" id="usStockCode" placeholder="ç¾è‚¡ä»£ç " value="HSAI" style="flex: 1;">
                            <button type="button" id="fetchUsPriceBtn" onclick="fetchUSStockPrice()" style="padding: 3px 6px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px;">
                                ğŸ“ˆ
                            </button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="usPrice">è‚¡ä»· (USD)</label>
                        <input type="number" id="usPrice" min="0" step="0.01">
                    </div>
                    
                    <div class="input-group">
                        <label for="usdToCny">ç¾å…ƒæ±‡ç‡</label>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="number" id="usdToCny" placeholder="USD/CNY" min="0" step="0.0001" style="flex: 1;">
                            <button type="button" id="fetchUsdBtn" onclick="fetchUSDExchangeRate()" style="padding: 3px 6px; background: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px;">
                                ğŸ”„
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- æ¸¯è‚¡åˆ— -->
                <div style="background: linear-gradient(135deg, #fff3e0, #fce4ec); padding: 4px; border-radius: 4px; border-left: 2px solid #ff9800;">
                    <h3 style="margin: 0 0 3px 0; color: #f57c00; font-size: 10px; text-align: center;">ğŸ‡­ğŸ‡° æ¸¯è‚¡ 02525</h3>
                    
                    <div class="input-group">
                        <label for="hkStockCode">è‚¡ç¥¨ä»£ç </label>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="text" id="hkStockCode" placeholder="æ¸¯è‚¡ä»£ç " value="02525" style="flex: 1;">
                            <button type="button" id="fetchHkPriceBtn" onclick="fetchHKStockPrice()" style="padding: 3px 6px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px;">
                                ğŸ“ˆ
                            </button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="hkPrice">è‚¡ä»· (HKD)</label>
                        <input type="number" id="hkPrice" min="0" step="0.01">
                    </div>
                    
                    <div class="input-group">
                        <label for="hkdToCny">æ¸¯å…ƒæ±‡ç‡</label>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="number" id="hkdToCny" placeholder="HKD/CNY" min="0" step="0.0001" style="flex: 1;">
                            <button type="button" id="fetchHkdBtn" onclick="fetchHKDExchangeRate()" style="padding: 3px 6px; background: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px;">
                                ğŸ”„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 4px 0;">
                <button type="button" onclick="fetchAllStockData()" style="padding: 4px 8px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: 600; margin-right: 4px; box-shadow: 0 1px 2px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                    ğŸ“Š è·å–æ‰€æœ‰æ•°æ®
                </button>
                <button type="button" onclick="fetchAllExchangeRates()" style="padding: 4px 8px; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: 600; margin-right: 4px; box-shadow: 0 1px 2px rgba(23, 162, 184, 0.3); transition: all 0.3s ease;">
                    ğŸŒ ä»…æ±‡ç‡
                </button>
                <button type="button" onclick="clearLocalStorage()" style="padding: 4px 8px; background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: 600; box-shadow: 0 1px 2px rgba(220, 53, 69, 0.3); transition: all 0.3s ease;">
                    ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
                </button>
            </div>
            
            <!-- <button class="calculate-btn" onclick="calculateValue()">
                ğŸ§® è®¡ç®—ä»·å€¼
            </button>
             -->
            <div id="results" class="results">
                <h3 style="text-align: center; margin: 0 0 4px 0; color: #333; font-size: 11px;">ğŸ“Š ä»·å€¼è®¡ç®—ç»“æœ</h3>
                
                <!-- å¸‚å€¼ç»“æœä¸¤åˆ—å¸ƒå±€ -->
                <div class="grid-2-columns" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
                    <!-- ç¾è‚¡å¸‚ä»·å€¼åˆ— -->
                    <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 4px; border-radius: 3px; border-left: 2px solid #2196f3;">
                        <h4 style="margin: 0 0 3px 0; color: #1976d2; font-size: 9px; text-align: center;">ğŸ‡ºğŸ‡¸ ç¾è‚¡å¸‚ä»·å€¼</h4>
                        <div style="text-align: center;">
                            <span id="usMarketValue" class="result-value" style="display: block; font-size: 11px; color: #28a745; font-weight: bold;"></span>
                        </div>
                    </div>
                    
                    <!-- æ¸¯è‚¡å¸‚ä»·å€¼åˆ— -->
                    <div style="background: linear-gradient(135deg, #fff3e0, #fce4ec); padding: 4px; border-radius: 3px; border-left: 2px solid #ff9800;">
                        <h4 style="margin: 0 0 3px 0; color: #f57c00; font-size: 9px; text-align: center;">ğŸ‡­ğŸ‡° æ¸¯è‚¡å¸‚ä»·å€¼</h4>
                        <div style="text-align: center;">
                            <span id="hkMarketValue" class="result-value" style="display: block; font-size: 11px; color: #28a745; font-weight: bold;"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="error" class="error" style="display: none;"></div>
        </div>
    </div>

    <script>
        function calculateValue() {
            // è·å–è¾“å…¥å€¼
            const shares = parseFloat(document.getElementById('shares').value) || 0;
            const usPrice = parseFloat(document.getElementById('usPrice').value) || 0;
            const hkPrice = parseFloat(document.getElementById('hkPrice').value) || 0;
            const strikePrice = parseFloat(document.getElementById('strikePrice').value) || 0;
            const usdToCny = parseFloat(document.getElementById('usdToCny').value) || 0;
            const hkdToCny = parseFloat(document.getElementById('hkdToCny').value) || 0;
            
            // éšè—é”™è¯¯ä¿¡æ¯
            document.getElementById('error').style.display = 'none';
            
            // éªŒè¯è¾“å…¥
            if (shares <= 0) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„è‚¡æ•°');
                return;
            }
            
            if (usPrice <= 0 && hkPrice <= 0) {
                showError('è¯·è‡³å°‘è¾“å…¥ä¸€ç§è‚¡ä»·ï¼ˆç¾è‚¡æˆ–æ¸¯è‚¡ï¼‰');
                return;
            }
            
            if (usPrice > 0 && usdToCny <= 0) {
                showError('è¯·è¾“å…¥ç¾å…ƒå…‘äººæ°‘å¸æ±‡ç‡');
                return;
            }
            
            if (hkPrice > 0 && hkdToCny <= 0) {
                showError('è¯·è¾“å…¥æ¸¯å…ƒå…‘äººæ°‘å¸æ±‡ç‡');
                return;
            }
            
            if (strikePrice <= 0) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„è¡Œæƒä»·');
                return;
            }
            
            // è®¡ç®—ä»·å€¼
            let usMarketValue = 0;
            let hkMarketValue = 0;
            let usCalculation = '';
            let hkCalculation = '';
            
            if (usPrice > 0 && usdToCny > 0) {
                // ç¾è‚¡è®¡ç®—ï¼š(è‚¡ä»· - è¡Œæƒä»·) * è‚¡æ•° * æ±‡ç‡
                const usProfitPerShare = usPrice - strikePrice;
                usMarketValue = usProfitPerShare * shares * usdToCny;
                usCalculation = `(${usPrice.toFixed(2)} - ${strikePrice.toFixed(2)}) Ã— ${shares.toLocaleString()} Ã— ${usdToCny.toFixed(4)} = ${formatCurrency(usMarketValue)}`;
            }
            
            if (hkPrice > 0 && hkdToCny > 0) {
                // æ¸¯è‚¡è®¡ç®—ï¼šå…ˆå°†è¡Œæƒä»·è½¬æ¢ä¸ºæ¸¯å…ƒï¼Œç„¶åè®¡ç®— (è‚¡ä»· - è¡Œæƒä»·) * è‚¡æ•° * æ±‡ç‡
                const strikePriceInHKD = strikePrice * usdToCny / hkdToCny; // ç¾å…ƒè¡Œæƒä»·è½¬æ¢ä¸ºæ¸¯å…ƒ
                const hkProfitPerShare = hkPrice - strikePriceInHKD;
                hkMarketValue = hkProfitPerShare * shares * hkdToCny;
                hkCalculation = `(${hkPrice.toFixed(2)} - ${strikePriceInHKD.toFixed(2)}) Ã— ${shares.toLocaleString()} Ã— ${hkdToCny.toFixed(4)} = ${formatCurrency(hkMarketValue)}`;
            }
            
            // æ˜¾ç¤ºç»“æœå’Œè®¡ç®—è¿‡ç¨‹
            if (usMarketValue !== 0) {
                document.getElementById('usMarketValue').innerHTML = 
                    `<div style="text-align: right;">
                        <div style="font-weight: 700; color: #28a745; font-size: 18px;">${formatCurrency(usMarketValue)}</div>
                        <div style="color: #666; font-size: 11px; margin-top: 4px; line-height: 1.3;">${usCalculation}</div>
                    </div>`;
            } else {
                document.getElementById('usMarketValue').textContent = 'æœªè®¡ç®—';
            }
            
            if (hkMarketValue !== 0) {
                document.getElementById('hkMarketValue').innerHTML = 
                    `<div style="text-align: right;">
                        <div style="font-weight: 700; color: #28a745; font-size: 18px;">${formatCurrency(hkMarketValue)}</div>
                        <div style="color: #666; font-size: 11px; margin-top: 4px; line-height: 1.3;">${hkCalculation}</div>
                    </div>`;
            } else {
                document.getElementById('hkMarketValue').textContent = 'æœªè®¡ç®—';
            }
            
            document.getElementById('results').style.display = 'block';
        }
        
        function formatCurrency(value) {
            return value.toLocaleString('zh-CN', {
                style: 'currency',
                currency: 'CNY',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }
        
        // å…è®¸æŒ‰Enteré”®è®¡ç®—
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateValue();
            }
        });
        
        // å®æ—¶è®¡ç®—ï¼ˆå½“æ‰€æœ‰å¿…è¦å­—æ®µéƒ½æœ‰å€¼æ—¶ï¼‰
        function autoCalculate() {
            const shares = parseFloat(document.getElementById('shares').value) || 0;
            const usPrice = parseFloat(document.getElementById('usPrice').value) || 0;
            const hkPrice = parseFloat(document.getElementById('hkPrice').value) || 0;
            const strikePrice = parseFloat(document.getElementById('strikePrice').value) || 0;
            const usdToCny = parseFloat(document.getElementById('usdToCny').value) || 0;
            const hkdToCny = parseFloat(document.getElementById('hkdToCny').value) || 0;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„è¾“å…¥æ¥è®¡ç®—
            const hasUSData = usPrice > 0 && usdToCny > 0 && strikePrice > 0;
            const hasHKData = hkPrice > 0 && hkdToCny > 0 && strikePrice > 0;
            
            if (shares > 0 && (hasUSData || hasHKData)) {
                calculateValue();
            }
        }
        
        // ä¸ºæ‰€æœ‰è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                autoCalculate();
                saveToLocalStorage(); // è‡ªåŠ¨ä¿å­˜
            });
        });
        
        // ä¸ºæ–‡æœ¬è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.querySelectorAll('input[type="text"]').forEach(input => {
            input.addEventListener('input', function() {
                saveToLocalStorage(); // è‡ªåŠ¨ä¿å­˜
            });
        });
        
        // ä¸ºè¡Œæƒä»·è¾“å…¥æ¡†æ·»åŠ ç‰¹æ®Šå¤„ç†
        document.getElementById('strikePrice').addEventListener('input', function() {
            autoCalculate();
            saveToLocalStorage(); // è‡ªåŠ¨ä¿å­˜
        });
        
        // ä¸ºè‚¡ç¥¨ä»£ç è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('usStockCode').addEventListener('blur', function() {
            if (this.value.trim()) {
                fetchUSStockPrice();
            }
        });
        
        document.getElementById('hkStockCode').addEventListener('blur', function() {
            if (this.value.trim()) {
                fetchHKStockPrice();
            }
        });
        
        // è‚¡ä»·è·å–åŠŸèƒ½ - æ”¯æŒå¤šä¸ªAPI
        async function fetchUSStockPrice() {
            const btn = document.getElementById('fetchUsPriceBtn');
            const input = document.getElementById('usPrice');
            const stockCode = document.getElementById('usStockCode').value.trim().toUpperCase();
            const originalText = btn.textContent;
            
            if (!stockCode) {
                showError('è¯·è¾“å…¥ç¾è‚¡ä»£ç ');
                return;
            }
            
            btn.textContent = 'â³ è·å–ä¸­...';
            btn.disabled = true;
            btn.classList.add('loading');
            
            try {
                // å°è¯•å¤šä¸ªAPIæº
                let price = null;
                let apiSource = '';
                
                // 1. å°è¯•æ–°æµªè´¢ç»API
                try {
                    const sinaResponse = await fetch(`http://hq.sinajs.cn/list=gb_${stockCode.toLowerCase()}`, {
                        mode: 'no-cors'
                    });
                    // ç”±äºCORSé™åˆ¶ï¼Œæ–°æµªAPIå¯èƒ½æ— æ³•ç›´æ¥è°ƒç”¨
                } catch (sinaError) {
                    console.log('æ–°æµªAPIè°ƒç”¨å¤±è´¥:', sinaError);
                }
                
                // 2. å°è¯•è…¾è®¯è´¢ç»API
                try {
                    const tencentResponse = await fetch(`http://qt.gtimg.cn/q=us${stockCode}`, {
                        mode: 'no-cors'
                    });
                    // ç”±äºCORSé™åˆ¶ï¼Œè…¾è®¯APIå¯èƒ½æ— æ³•ç›´æ¥è°ƒç”¨
                } catch (tencentError) {
                    console.log('è…¾è®¯APIè°ƒç”¨å¤±è´¥:', tencentError);
                }
                
                // 3. å°è¯•Yahoo Finance API
                try {
                    const yahooResponse = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${stockCode}`);
                    const yahooData = await yahooResponse.json();
                    
                    if (yahooData.chart && yahooData.chart.result && yahooData.chart.result[0]) {
                        const quote = yahooData.chart.result[0].meta;
                        price = quote.regularMarketPrice;
                        apiSource = 'Yahoo Finance';
                    }
                } catch (yahooError) {
                    console.log('Yahoo Finance APIè°ƒç”¨å¤±è´¥:', yahooError);
                }
                
                // 4. å°è¯•Finnhub API (å…è´¹)
                if (!price) {
                    try {
                        const finnhubResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${stockCode}&token=free`);
                        const finnhubData = await finnhubResponse.json();
                        
                        if (finnhubData.c && finnhubData.c > 0) {
                            price = finnhubData.c;
                            apiSource = 'Finnhub';
                        }
                    } catch (finnhubError) {
                        console.log('Finnhub APIè°ƒç”¨å¤±è´¥:', finnhubError);
                    }
                }
                
                // 5. å°è¯•Polygon.io API (å…è´¹)
                if (!price) {
                    try {
                        const polygonResponse = await fetch(`https://api.polygon.io/v1/last/stocks/${stockCode}?apikey=free`);
                        const polygonData = await polygonResponse.json();
                        
                        if (polygonData.last && polygonData.last.trade && polygonData.last.trade.p) {
                            price = polygonData.last.trade.p;
                            apiSource = 'Polygon.io';
                        }
                    } catch (polygonError) {
                        console.log('Polygon.io APIè°ƒç”¨å¤±è´¥:', polygonError);
                    }
                }
                
                // 6. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®Yahoo Finance
                if (!price) {
                    try {
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${stockCode}`)}`);
                        const proxyData = await proxyResponse.json();
                        const yahooData = JSON.parse(proxyData.contents);
                        
                        if (yahooData.chart && yahooData.chart.result && yahooData.chart.result[0]) {
                            const quote = yahooData.chart.result[0].meta;
                            price = quote.regularMarketPrice;
                            apiSource = 'Yahoo Finance (ä»£ç†)';
                        }
                    } catch (proxyError) {
                        console.log('ä»£ç†APIè°ƒç”¨å¤±è´¥:', proxyError);
                    }
                }
                
                // 7. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®æ–°æµªè´¢ç»ç¾è‚¡
                if (!price) {
                    try {
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`http://hq.sinajs.cn/list=gb_${stockCode.toLowerCase()}`)}`);
                        const proxyData = await proxyResponse.json();
                        const sinaData = proxyData.contents;
                        
                        if (sinaData && sinaData.includes(',')) {
                            const parts = sinaData.split(',');
                            if (parts.length > 1 && parts[1]) {
                                price = parseFloat(parts[1]);
                                apiSource = 'æ–°æµªè´¢ç»ç¾è‚¡ (ä»£ç†)';
                            }
                        }
                    } catch (sinaError) {
                        console.log('æ–°æµªè´¢ç»ç¾è‚¡APIè°ƒç”¨å¤±è´¥:', sinaError);
                    }
                }
                
                // 8. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®è…¾è®¯è´¢ç»ç¾è‚¡
                if (!price) {
                    try {
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`http://qt.gtimg.cn/q=us${stockCode}`)}`);
                        const proxyData = await proxyResponse.json();
                        const tencentData = proxyData.contents;
                        
                        if (tencentData && tencentData.includes('~')) {
                            const parts = tencentData.split('~');
                            if (parts.length > 3 && parts[3]) {
                                price = parseFloat(parts[3]);
                                apiSource = 'è…¾è®¯è´¢ç»ç¾è‚¡ (ä»£ç†)';
                            }
                        }
                    } catch (tencentError) {
                        console.log('è…¾è®¯è´¢ç»ç¾è‚¡APIè°ƒç”¨å¤±è´¥:', tencentError);
                    }
                }
                
                // 9. å°è¯•ä½¿ç”¨CORSä»£ç†
                if (!price) {
                    try {
                        const corsProxyResponse = await fetch(`https://cors-anywhere.herokuapp.com/https://query1.finance.yahoo.com/v8/finance/chart/${stockCode}`);
                        const corsProxyData = await corsProxyResponse.json();
                        
                        if (corsProxyData.chart && corsProxyData.chart.result && corsProxyData.chart.result[0]) {
                            const quote = corsProxyData.chart.result[0].meta;
                            price = quote.regularMarketPrice;
                            apiSource = 'Yahoo Finance (CORSä»£ç†)';
                        }
                    } catch (corsError) {
                        console.log('CORSä»£ç†APIè°ƒç”¨å¤±è´¥:', corsError);
                    }
                }
                
                // 10. å°è¯•IEX Cloud API (å…è´¹)
                if (!price) {
                    try {
                        const iexResponse = await fetch(`https://cloud.iexapis.com/stable/stock/${stockCode}/quote?token=free`);
                        const iexData = await iexResponse.json();
                        
                        if (iexData.latestPrice && iexData.latestPrice > 0) {
                            price = iexData.latestPrice;
                            apiSource = 'IEX Cloud';
                        }
                    } catch (iexError) {
                        console.log('IEX Cloud APIè°ƒç”¨å¤±è´¥:', iexError);
                    }
                }
                
                if (price && price > 0) {
                    input.value = price.toFixed(2);
                    showSuccessMessage(`âœ… ${stockCode} è‚¡ä»·å·²æ›´æ–°: $${price.toFixed(2)} (æ¥æº: ${apiSource})`);
                    // å»¶è¿Ÿè®¡ç®—ï¼Œç¡®ä¿æ•°æ®å·²å¡«å……
                    setTimeout(() => {
                        autoCalculate();
                    }, 100);
                } else {
                    throw new Error('æ‰€æœ‰APIéƒ½æ— æ³•è·å–è‚¡ä»·æ•°æ®');
                }
                
            } catch (error) {
                console.error('è·å–ç¾è‚¡ä»·æ ¼å¤±è´¥:', error);
                // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockPrice = Math.random() * 50 + 10; // æ¨¡æ‹Ÿä»·æ ¼ 10-60 USD
                input.value = mockPrice.toFixed(2);
                showSuccessMessage(`âš ï¸ ${stockCode} ä½¿ç”¨æ¨¡æ‹Ÿä»·æ ¼: $${mockPrice.toFixed(2)} (æ‰€æœ‰APIè°ƒç”¨å¤±è´¥)`);
                setTimeout(() => {
                    autoCalculate();
                }, 100);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }
        
        async function fetchHKStockPrice() {
            const btn = document.getElementById('fetchHkPriceBtn');
            const input = document.getElementById('hkPrice');
            const stockCode = document.getElementById('hkStockCode').value.trim();
            const originalText = btn.textContent;
            
            if (!stockCode) {
                showError('è¯·è¾“å…¥æ¸¯è‚¡ä»£ç ');
                return;
            }
            
            btn.textContent = 'â³ è·å–ä¸­...';
            btn.disabled = true;
            btn.classList.add('loading');
            
            try {
                // å°è¯•å¤šä¸ªAPIæº
                let price = null;
                let apiSource = '';
                
                // 1. å°è¯•Yahoo Finance API (æ¸¯è‚¡éœ€è¦æ·»åŠ .HKåç¼€)
                try {
                    const yahooCode = stockCode + '.HK';
                    const yahooResponse = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${yahooCode}`);
                    const yahooData = await yahooResponse.json();
                    
                    if (yahooData.chart && yahooData.chart.result && yahooData.chart.result[0]) {
                        const quote = yahooData.chart.result[0].meta;
                        price = quote.regularMarketPrice;
                        apiSource = 'Yahoo Finance';
                    }
                } catch (yahooError) {
                    console.log('Yahoo Finance APIè°ƒç”¨å¤±è´¥:', yahooError);
                }
                
                // 2. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®æ–°æµªè´¢ç»
                if (!price) {
                    try {
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`http://hq.sinajs.cn/list=hk${stockCode}`)}`);
                        const proxyData = await proxyResponse.json();
                        const sinaData = proxyData.contents;
                        
                        if (sinaData && sinaData.includes(',')) {
                            const parts = sinaData.split(',');
                            if (parts.length > 3 && parts[3]) {
                                price = parseFloat(parts[3]);
                                apiSource = 'æ–°æµªè´¢ç» (ä»£ç†)';
                            }
                        }
                    } catch (sinaError) {
                        console.log('æ–°æµªè´¢ç»APIè°ƒç”¨å¤±è´¥:', sinaError);
                    }
                }
                
                // 3. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®è…¾è®¯è´¢ç»
                if (!price) {
                    try {
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`http://qt.gtimg.cn/q=hk${stockCode}`)}`);
                        const proxyData = await proxyResponse.json();
                        const tencentData = proxyData.contents;
                        
                        if (tencentData && tencentData.includes('~')) {
                            const parts = tencentData.split('~');
                            if (parts.length > 3 && parts[3]) {
                                price = parseFloat(parts[3]);
                                apiSource = 'è…¾è®¯è´¢ç» (ä»£ç†)';
                            }
                        }
                    } catch (tencentError) {
                        console.log('è…¾è®¯è´¢ç»APIè°ƒç”¨å¤±è´¥:', tencentError);
                    }
                }
                
                // 4. å°è¯•ä½¿ç”¨ä»£ç†APIè®¿é—®Yahoo Finance
                if (!price) {
                    try {
                        const yahooCode = stockCode + '.HK';
                        const proxyResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${yahooCode}`)}`);
                        const proxyData = await proxyResponse.json();
                        const yahooData = JSON.parse(proxyData.contents);
                        
                        if (yahooData.chart && yahooData.chart.result && yahooData.chart.result[0]) {
                            const quote = yahooData.chart.result[0].meta;
                            price = quote.regularMarketPrice;
                            apiSource = 'Yahoo Finance (ä»£ç†)';
                        }
                    } catch (proxyError) {
                        console.log('ä»£ç†APIè°ƒç”¨å¤±è´¥:', proxyError);
                    }
                }
                
                // 5. å°è¯•Finnhub API (å…è´¹) - æ¸¯è‚¡
                if (!price) {
                    try {
                        const yahooCode = stockCode + '.HK';
                        const finnhubResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${yahooCode}&token=free`);
                        const finnhubData = await finnhubResponse.json();
                        
                        if (finnhubData.c && finnhubData.c > 0) {
                            price = finnhubData.c;
                            apiSource = 'Finnhub';
                        }
                    } catch (finnhubError) {
                        console.log('Finnhub APIè°ƒç”¨å¤±è´¥:', finnhubError);
                    }
                }
                
                // 6. å°è¯•Alpha Vantage API (å¦‚æœæœ‰API Key)
                if (!price) {
                    try {
                        const alphaVantageKey = 'demo'; // å…è´¹ç‰ˆæœ‰é™åˆ¶
                        const alphaResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${stockCode}.HK&apikey=${alphaVantageKey}`);
                        const alphaData = await alphaResponse.json();
                        
                        if (alphaData['Global Quote'] && alphaData['Global Quote']['05. price']) {
                            price = parseFloat(alphaData['Global Quote']['05. price']);
                            apiSource = 'Alpha Vantage';
                        }
                    } catch (alphaError) {
                        console.log('Alpha Vantage APIè°ƒç”¨å¤±è´¥:', alphaError);
                    }
                }
                
                // 7. å°è¯•IEX Cloud API (å…è´¹) - æ¸¯è‚¡
                if (!price) {
                    try {
                        const iexResponse = await fetch(`https://cloud.iexapis.com/stable/stock/${stockCode}.HK/quote?token=free`);
                        const iexData = await iexResponse.json();
                        
                        if (iexData.latestPrice && iexData.latestPrice > 0) {
                            price = iexData.latestPrice;
                            apiSource = 'IEX Cloud';
                        }
                    } catch (iexError) {
                        console.log('IEX Cloud APIè°ƒç”¨å¤±è´¥:', iexError);
                    }
                }
                
                // 8. å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªä»£ç†æœåŠ¡
                if (!price) {
                    try {
                        const yahooCode = stockCode + '.HK';
                        const corsProxyResponse = await fetch(`https://cors-anywhere.herokuapp.com/https://query1.finance.yahoo.com/v8/finance/chart/${yahooCode}`);
                        const corsProxyData = await corsProxyResponse.json();
                        
                        if (corsProxyData.chart && corsProxyData.chart.result && corsProxyData.chart.result[0]) {
                            const quote = corsProxyData.chart.result[0].meta;
                            price = quote.regularMarketPrice;
                            apiSource = 'Yahoo Finance (CORSä»£ç†)';
                        }
                    } catch (corsError) {
                        console.log('CORSä»£ç†APIè°ƒç”¨å¤±è´¥:', corsError);
                    }
                }
                
                if (price && price > 0) {
                    input.value = price.toFixed(2);
                    showSuccessMessage(`âœ… ${stockCode} è‚¡ä»·å·²æ›´æ–°: HK$${price.toFixed(2)} (æ¥æº: ${apiSource})`);
                    // å»¶è¿Ÿè®¡ç®—ï¼Œç¡®ä¿æ•°æ®å·²å¡«å……
                    setTimeout(() => {
                        autoCalculate();
                    }, 100);
                } else {
                    throw new Error('æ‰€æœ‰APIéƒ½æ— æ³•è·å–è‚¡ä»·æ•°æ®');
                }
                
            } catch (error) {
                console.error('è·å–æ¸¯è‚¡ä»·æ ¼å¤±è´¥:', error);
                // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockPrice = Math.random() * 20 + 5; // æ¨¡æ‹Ÿä»·æ ¼ 5-25 HKD
                input.value = mockPrice.toFixed(2);
                showSuccessMessage(`âš ï¸ ${stockCode} ä½¿ç”¨æ¨¡æ‹Ÿä»·æ ¼: HK$${mockPrice.toFixed(2)} (æ‰€æœ‰APIè°ƒç”¨å¤±è´¥)`);
                setTimeout(() => {
                    autoCalculate();
                }, 100);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }
        
        async function fetchAllStockData() {
            const allBtn = document.querySelector('button[onclick="fetchAllStockData()"]');
            const originalText = allBtn ? allBtn.textContent : '';
            
            if (allBtn) {
                allBtn.textContent = 'â³ è·å–æ‰€æœ‰æ•°æ®ä¸­...';
                allBtn.disabled = true;
                allBtn.classList.add('loading');
            }
            
            try {
                // åŒæ—¶è·å–è‚¡ä»·å’Œæ±‡ç‡
                await Promise.all([
                    fetchUSStockPrice(),
                    fetchHKStockPrice(),
                    fetchAllExchangeRates()
                ]);
                
                // è·å–å®Œæ•°æ®åè‡ªåŠ¨è®¡ç®—
                setTimeout(() => {
                    calculateValue();
                }, 500); // å»¶è¿Ÿ500msç¡®ä¿æ•°æ®å·²å¡«å……
                
                showSuccessMessage('âœ… æ‰€æœ‰è‚¡ä»·å’Œæ±‡ç‡æ•°æ®å·²æ›´æ–°å®Œæˆï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼ï¼');
            } catch (error) {
                console.error('è·å–æ‰€æœ‰æ•°æ®å¤±è´¥:', error);
                showError('è·å–æ•°æ®æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                if (allBtn) {
                    allBtn.textContent = originalText;
                    allBtn.disabled = false;
                    allBtn.classList.remove('loading');
                }
            }
        }
        
        // æ±‡ç‡è·å–åŠŸèƒ½
        async function fetchUSDExchangeRate() {
            const btn = document.getElementById('fetchUsdBtn');
            const input = document.getElementById('usdToCny');
            const originalText = btn.textContent;
            
            btn.textContent = 'â³ è·å–ä¸­...';
            btn.disabled = true;
            btn.classList.add('loading');
            
            try {
                // ä½¿ç”¨å…è´¹çš„æ±‡ç‡API
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                
                if (data.rates && data.rates.CNY) {
                    const rate = data.rates.CNY;
                    input.value = rate.toFixed(4);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showSuccessMessage('âœ… USD/CNY æ±‡ç‡å·²æ›´æ–°: ' + rate.toFixed(4) + 'ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼ï¼');
                    
                    // è‡ªåŠ¨è®¡ç®—
                    setTimeout(() => {
                        autoCalculate();
                    }, 100);
                } else {
                    throw new Error('æ— æ³•è·å–USDæ±‡ç‡æ•°æ®');
                }
            } catch (error) {
                console.error('è·å–USDæ±‡ç‡å¤±è´¥:', error);
                showError('è·å–ç¾å…ƒæ±‡ç‡å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ±‡ç‡');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }
        
        async function fetchHKDExchangeRate() {
            const btn = document.getElementById('fetchHkdBtn');
            const input = document.getElementById('hkdToCny');
            const originalText = btn.textContent;
            
            btn.textContent = 'â³ è·å–ä¸­...';
            btn.disabled = true;
            btn.classList.add('loading');
            
            try {
                // ä½¿ç”¨å…è´¹çš„æ±‡ç‡API
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/HKD');
                const data = await response.json();
                
                if (data.rates && data.rates.CNY) {
                    const rate = data.rates.CNY;
                    input.value = rate.toFixed(4);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showSuccessMessage('âœ… HKD/CNY æ±‡ç‡å·²æ›´æ–°: ' + rate.toFixed(4) + 'ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼ï¼');
                    
                    // è‡ªåŠ¨è®¡ç®—
                    setTimeout(() => {
                        autoCalculate();
                    }, 100);
                } else {
                    throw new Error('æ— æ³•è·å–HKDæ±‡ç‡æ•°æ®');
                }
            } catch (error) {
                console.error('è·å–HKDæ±‡ç‡å¤±è´¥:', error);
                showError('è·å–æ¸¯å…ƒæ±‡ç‡å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ±‡ç‡');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }
        
        async function fetchAllExchangeRates() {
            const allBtn = document.querySelector('button[onclick="fetchAllExchangeRates()"]');
            const originalText = allBtn.textContent;
            
            allBtn.textContent = 'â³ è·å–æ‰€æœ‰æ±‡ç‡ä¸­...';
            allBtn.disabled = true;
            allBtn.classList.add('loading');
            
            try {
                // åŒæ—¶è·å–USDå’ŒHKDæ±‡ç‡
                const [usdResponse, hkdResponse] = await Promise.all([
                    fetch('https://api.exchangerate-api.com/v4/latest/USD'),
                    fetch('https://api.exchangerate-api.com/v4/latest/HKD')
                ]);
                
                const usdData = await usdResponse.json();
                const hkdData = await hkdResponse.json();
                
                if (usdData.rates && usdData.rates.CNY && hkdData.rates && hkdData.rates.CNY) {
                    const usdRate = usdData.rates.CNY;
                    const hkdRate = hkdData.rates.CNY;
                    
                    document.getElementById('usdToCny').value = usdRate.toFixed(4);
                    document.getElementById('hkdToCny').value = hkdRate.toFixed(4);
                    
                    // éšè—è‡ªåŠ¨åŠ è½½æç¤º
                    hideAutoLoadingMessage();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showSuccessMessage(`âœ… æ‰€æœ‰æ±‡ç‡å·²æ›´æ–°ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼ï¼<br>
                        USD/CNY: ${usdRate.toFixed(4)}<br>
                        HKD/CNY: ${hkdRate.toFixed(4)}`);
                    
                    // è‡ªåŠ¨è®¡ç®—
                    setTimeout(() => {
                        autoCalculate();
                    }, 100);
                } else {
                    throw new Error('æ— æ³•è·å–æ±‡ç‡æ•°æ®');
                }
            } catch (error) {
                console.error('è·å–æ±‡ç‡å¤±è´¥:', error);
                hideAutoLoadingMessage();
                showError('è·å–æ±‡ç‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ‰‹åŠ¨è¾“å…¥æ±‡ç‡');
            } finally {
                allBtn.textContent = originalText;
                allBtn.disabled = false;
                allBtn.classList.remove('loading');
            }
        }
        
        function showSuccessMessage(message) {
            // ç§»é™¤ä¹‹å‰çš„æˆåŠŸæ¶ˆæ¯
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = message;
            
            // æ’å…¥åˆ°è¡¨å•å®¹å™¨ä¸­
            const formContainer = document.querySelector('.form-container');
            const calculateBtn = document.querySelector('.calculate-btn');
            formContainer.insertBefore(successDiv, calculateBtn);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }
        
        // localStorage åŠŸèƒ½
        function saveToLocalStorage() {
            const data = {
                shares: document.getElementById('shares').value,
                strikePrice: document.getElementById('strikePrice').value,
                usStockCode: document.getElementById('usStockCode').value,
                usPrice: document.getElementById('usPrice').value,
                usdToCny: document.getElementById('usdToCny').value,
                hkStockCode: document.getElementById('hkStockCode').value,
                hkPrice: document.getElementById('hkPrice').value,
                hkdToCny: document.getElementById('hkdToCny').value
            };
            localStorage.setItem('stockCalculatorData', JSON.stringify(data));
        }
        
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('stockCalculatorData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.shares) document.getElementById('shares').value = data.shares;
                    if (data.strikePrice) document.getElementById('strikePrice').value = data.strikePrice;
                    if (data.usStockCode) document.getElementById('usStockCode').value = data.usStockCode;
                    if (data.usPrice) document.getElementById('usPrice').value = data.usPrice;
                    if (data.usdToCny) document.getElementById('usdToCny').value = data.usdToCny;
                    if (data.hkStockCode) document.getElementById('hkStockCode').value = data.hkStockCode;
                    if (data.hkPrice) document.getElementById('hkPrice').value = data.hkPrice;
                    if (data.hkdToCny) document.getElementById('hkdToCny').value = data.hkdToCny;
                } catch (e) {
                    console.log('åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥:', e);
                }
            }
        }
        
        function clearLocalStorage() {
            localStorage.removeItem('stockCalculatorData');
            // æ¸…ç©ºæ‰€æœ‰è¾“å…¥æ¡†
            document.getElementById('shares').value = '';
            document.getElementById('strikePrice').value = '';
            document.getElementById('usStockCode').value = '';
            document.getElementById('usPrice').value = '';
            document.getElementById('usdToCny').value = '';
            document.getElementById('hkStockCode').value = '';
            document.getElementById('hkPrice').value = '';
            document.getElementById('hkdToCny').value = '';
            showSuccessMessage('âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼ï¼');
        }
        
        // é¡µé¢åŠ è½½æ—¶éšè—ç»“æœåŒºåŸŸå¹¶è‡ªåŠ¨è·å–æ±‡ç‡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('results').style.display = 'none';
            
            // åŠ è½½æœ¬åœ°ä¿å­˜çš„æ•°æ®
            loadFromLocalStorage();
            
            // æ˜¾ç¤ºè‡ªåŠ¨åŠ è½½æç¤º
            showAutoLoadingMessage();
            
            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ‰€æœ‰æ•°æ®ï¼ˆè‚¡ä»·å’Œæ±‡ç‡ï¼‰å¹¶è®¡ç®—
            setTimeout(() => {
                fetchAllStockData();
            }, 500); // å»¶è¿Ÿ500msç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        });
        
        function showAutoLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'auto-loading';
            loadingDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è‡ªåŠ¨è·å–æœ€æ–°è‚¡ä»·å’Œæ±‡ç‡æ•°æ®ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—ä»·å€¼...';
            loadingDiv.id = 'auto-loading-message';
            
            // æ’å…¥åˆ°ä½¿ç”¨è¯´æ˜ä¹‹å
            const infoTip = document.querySelector('.info-tip');
            infoTip.parentNode.insertBefore(loadingDiv, infoTip.nextSibling);
        }
        
        function hideAutoLoadingMessage() {
            const loadingDiv = document.getElementById('auto-loading-message');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }
    </script>
</body>
</html>
